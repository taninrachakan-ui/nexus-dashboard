<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS // REAL MONITOR</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- CSS เดิมของคุณ 100% --- */
        :root { --bg-dark: #080a12; --card-bg: rgba(20, 25, 40, 0.4); --glass-border: rgba(255, 255, 255, 0.08); --primary: #00f0ff; --secondary: #00ff9d; --accent: #7000ff; --text-main: #ffffff; --text-dim: #8b9bb4; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background-color: var(--bg-dark); background-image: radial-gradient(circle at 10% 10%, rgba(0, 240, 255, 0.15) 0%, transparent 40%), radial-gradient(circle at 90% 90%, rgba(112, 0, 255, 0.15) 0%, transparent 40%); color: var(--text-main); font-family: 'Rajdhani', sans-serif; min-height: 100vh; padding: 20px; overflow-x: hidden; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 15px; background: linear-gradient(90deg, rgba(0,240,255,0.1), transparent); border-left: 3px solid var(--primary); border-radius: 4px; backdrop-filter: blur(10px); }
        .header h1 { margin: 0; font-size: 18px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; }
        .status-indicator { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--secondary); display: flex; align-items: center; justify-content: center; box-shadow: 0 0 15px rgba(0, 255, 157, 0.3); font-size: 10px; color: var(--secondary); font-weight: bold; background: rgba(0, 255, 157, 0.1); animation: pulse-green 2s infinite; }
        .card { background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 20px; padding: 20px; margin-bottom: 20px; backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: -50px; left: -50px; width: 100px; height: 100px; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); pointer-events: none; }
        .card-title { font-size: 12px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 15px; display: block; }
        .chart-container { width: 100%; height: 100px; position: relative; }
        canvas#waveChart { width: 100%; height: 100%; }
        .reach-container { display: flex; align-items: center; justify-content: space-between; }
        .reach-stats h2 { font-size: 32px; margin: 0; font-weight: 700; text-shadow: 0 0 10px rgba(255,255,255,0.3); }
        .reach-stats span { font-size: 14px; color: var(--primary); }
        .reach-stats p { margin: 5px 0 0; font-size: 10px; color: var(--text-dim); }
        .map-visual { width: 60%; height: 80px; position: relative; }
        canvas#networkCanvas { width: 100%; height: 100%; }
        .load-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .bar-group { display: flex; flex-direction: column; gap: 8px; justify-content: center;}
        .progress-row { display: flex; align-items: center; gap: 10px; }
        .progress-track { flex-grow: 1; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 3px; width: 0%; transition: width 1s ease; }
        .progress-val { font-family: 'JetBrains Mono'; font-size: 10px; width: 30px; text-align: right; }
        .col-group { display: flex; justify-content: space-around; align-items: flex-end; height: 80px; padding-bottom: 20px; }
        .v-col-contain { display: flex; flex-direction: column; align-items: center; gap: 5px; height: 100%; justify-content: flex-end; }
        .v-track { width: 12px; height: 60px; background: rgba(255,255,255,0.05); border-radius: 4px; position: relative; overflow: hidden; }
        .v-fill { position: absolute; bottom: 0; width: 100%; background: var(--primary); transition: height 0.5s; }
        .v-label { font-size: 8px; color: var(--text-dim); }
        .uptime-flex { display: flex; align-items: center; justify-content: space-between; }
        .time-display { font-family: 'JetBrains Mono', monospace; font-size: 36px; font-weight: 700; color: white; text-shadow: 0 0 15px rgba(0, 240, 255, 0.5); }
        .circle-chart { width: 80px; height: 80px; position: relative; }
        .circle-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 6; }
        .circle-bar { fill: none; stroke: var(--secondary); stroke-width: 6; stroke-linecap: round; stroke-dasharray: 220; stroke-dashoffset: 220; transition: stroke-dashoffset 1s; filter: drop-shadow(0 0 4px var(--secondary)); }
        .circle-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 16px; font-weight: bold; }
        .logs-box { height: 120px; font-family: 'JetBrains Mono', monospace; font-size: 10px; overflow: hidden; display: flex; flex-direction: column; justify-content: flex-end; position: relative; }
        .logs-box::before { content: ''; position: absolute; top:0; left:0; width:100%; height: 30px; background: linear-gradient(to bottom, var(--card-bg), transparent); z-index: 2; }
        .log-entry { margin-bottom: 4px; opacity: 0.7; }
        .log-entry span { color: var(--secondary); }
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(0, 255, 157, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(0, 255, 157, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 255, 157, 0); } }
    </style>
</head>
<body>

    <div class="header">
        <h1>Nexus Relay // Monitor</h1>
        <div class="status-indicator" id="statusIcon">ON</div>
    </div>

    <div class="card">
        <span class="card-title">Data Throughput</span>
        <div class="chart-container">
            <canvas id="waveChart"></canvas>
        </div>
        <div style="display:flex; justify-content:space-between; margin-top:5px; font-size:10px; color:var(--text-dim);">
            <span>RX: <span id="rxVal">0</span> MB/s</span>
            <span>TX: <span id="txVal">0</span> MB/s</span>
        </div>
    </div>

    <div class="card">
        <span class="card-title">Node Status</span>
        <div class="reach-container">
            <div class="reach-stats">
                <h2 id="cpuBig">0.0 <span>%</span></h2>
                <p>SYSTEM CORE LOAD</p>
            </div>
            <div class="map-visual">
                <canvas id="networkCanvas"></canvas>
            </div>
        </div>
    </div>

    <div class="card">
        <span class="card-title">System Load</span>
        <div class="load-grid">
            <div class="bar-group">
                <div class="progress-row">
                    <div class="progress-track"><div class="progress-fill" id="h-bar-1" style="width:0%; background:var(--secondary);"></div></div>
                    <div class="progress-val" style="color:var(--secondary)">IO</div>
                </div>
                <div class="progress-row">
                    <div class="progress-track"><div class="progress-fill" id="h-bar-2" style="width:0%; background:var(--primary);"></div></div>
                    <div class="progress-val" style="color:var(--primary)">NET</div>
                </div>
                <div class="progress-row">
                    <div class="progress-track"><div class="progress-fill" id="h-bar-3" style="width:0%; background:var(--accent);"></div></div>
                    <div class="progress-val" style="color:var(--accent)">PWR</div>
                </div>
                <div style="font-size:8px; color:var(--text-dim); text-align:right; margin-top:5px;">METRICS</div>
            </div>

            <div class="col-group">
                <div class="v-col-contain">
                    <div class="v-track"><div class="v-fill" style="height:0%; background:#007bff;" id="bar-cpu"></div></div>
                    <span class="v-label">CPU</span>
                </div>
                <div class="v-col-contain">
                    <div class="v-track"><div class="v-fill" style="height:0%; background:#00f0ff;" id="bar-ram"></div></div>
                    <span class="v-label">RAM</span>
                </div>
                <div class="v-col-contain">
                    <div class="v-track"><div class="v-fill" style="height:50%; background:#00ff9d;" id="bar-dsk"></div></div>
                    <span class="v-label">DSK</span>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <span class="card-title">System Uptime</span>
        <div class="uptime-flex">
            <div class="time-display" id="uptimeText">00:00:00</div>
            <div class="circle-chart">
                <svg width="80" height="80" viewBox="0 0 80 80">
                    <circle class="circle-bg" cx="40" cy="40" r="35"></circle>
                    <circle class="circle-bar" id="uptimeRing" cx="40" cy="40" r="35"></circle>
                </svg>
                <div class="circle-text" id="uptimePercent">ON</div>
            </div>
        </div>
    </div>

    <div class="card">
        <span class="card-title">System Logs</span>
        <div class="logs-box" id="logContainer">
            <div class="log-entry">[INIT] <span>Interface Loaded</span></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // --- VISUALS: WAVE CHART (Canvas) ---
        const waveCanvas = document.getElementById('waveChart');
        const waveCtx = waveCanvas.getContext('2d');
        function resizeCanvas(c) { c.width = c.clientWidth; c.height = c.clientHeight; }
        resizeCanvas(waveCanvas);

        let offset = 0;
        let waveHeight = 10; // Dynamic Amplitude based on CPU

        function drawWave() {
            const w = waveCanvas.width;
            const h = waveCanvas.height;
            waveCtx.clearRect(0, 0, w, h);

            const grad = waveCtx.createLinearGradient(0, 0, 0, h);
            grad.addColorStop(0, 'rgba(0, 240, 255, 0.5)');
            grad.addColorStop(1, 'rgba(0, 240, 255, 0)');

            waveCtx.beginPath();
            waveCtx.moveTo(0, h);
            for (let i = 0; i <= w; i += 5) {
                const y = (h / 2) + Math.sin((i + offset) * 0.03) * waveHeight + Math.sin((i + offset * 2) * 0.05) * (waveHeight/2);
                waveCtx.lineTo(i, y);
            }
            waveCtx.lineTo(w, h);
            waveCtx.fillStyle = grad;
            waveCtx.fill();

            waveCtx.beginPath();
            for (let i = 0; i <= w; i += 5) {
                const y = (h / 2) + Math.sin((i + offset) * 0.03) * waveHeight + Math.sin((i + offset * 2) * 0.05) * (waveHeight/2);
                waveCtx.lineTo(i, y);
            }
            waveCtx.strokeStyle = '#00f0ff';
            waveCtx.lineWidth = 2;
            waveCtx.stroke();
            offset += 2;
            requestAnimationFrame(drawWave);
        }
        drawWave();

        // --- VISUALS: NETWORK DOTS ---
        const netCanvas = document.getElementById('networkCanvas');
        const netCtx = netCanvas.getContext('2d');
        resizeCanvas(netCanvas);
        let dots = Array.from({length:8}, () => ({x:Math.random()*netCanvas.width, y:Math.random()*netCanvas.height, vx:(Math.random()-0.5), vy:(Math.random()-0.5)}));
        
        function drawNetwork() {
            netCtx.clearRect(0, 0, netCanvas.width, netCanvas.height);
            netCtx.fillStyle = '#00ff9d'; netCtx.strokeStyle = 'rgba(0, 255, 157, 0.3)';
            dots.forEach((dot, i) => {
                dot.x += dot.vx; dot.y += dot.vy;
                if(dot.x<0 || dot.x>netCanvas.width) dot.vx*=-1;
                if(dot.y<0 || dot.y>netCanvas.height) dot.vy*=-1;
                netCtx.beginPath(); netCtx.arc(dot.x, dot.y, 3, 0, Math.PI*2); netCtx.fill();
                for(let j=i+1; j<dots.length; j++) {
                    if(Math.hypot(dot.x-dots[j].x, dot.y-dots[j].y) < 60) {
                        netCtx.beginPath(); netCtx.moveTo(dot.x, dot.y); netCtx.lineTo(dots[j].x, dots[j].y); netCtx.stroke();
                    }
                }
            });
            requestAnimationFrame(drawNetwork);
        }
        drawNetwork();

        // --- REAL DATA LOGIC (Socket.io) ---
        const socket = io();
        
        socket.on('connect', () => {
            document.getElementById('statusIcon').style.boxShadow = "0 0 15px #00ff9d";
            document.getElementById('statusIcon').innerText = "LINKED";
            addLog("sys", "Connection established with Host.");
        });

        socket.on('disconnect', () => {
            document.getElementById('statusIcon').style.boxShadow = "none";
            document.getElementById('statusIcon').innerText = "LOST";
            document.getElementById('statusIcon').style.borderColor = "#ff0055";
            document.getElementById('statusIcon').style.color = "#ff0055";
            addLog("error", "Connection lost.");
        });

        // รับข้อมูล System Stats จาก Server
        socket.on('system-stats', (data) => {
            // 1. CPU
            document.getElementById('bar-cpu').style.height = data.cpu + '%';
            document.getElementById('cpuBig').innerHTML = data.cpu + ' <span>%</span>';
            
            // ทำให้คลื่นน้ำสูงต่ำตาม CPU
            waveHeight = 10 + (data.cpu / 5); 

            // 2. RAM
            document.getElementById('bar-ram').style.height = data.ram + '%';

            // 3. Fake Bars (ทำให้ดูสวย ขยับตาม CPU นิดหน่อย)
            document.getElementById('h-bar-1').style.width = (data.cpu * 0.8) + '%'; 
            document.getElementById('h-bar-2').style.width = (data.ram * 0.9) + '%';
            document.getElementById('h-bar-3').style.width = '90%';

            // 4. Network Text
            document.getElementById('rxVal').innerText = data.netRx;
            document.getElementById('txVal').innerText = data.netTx;

            // 5. Uptime Logic
            const h = Math.floor(data.uptime / 3600).toString().padStart(2,'0');
            const m = Math.floor((data.uptime % 3600) / 60).toString().padStart(2,'0');
            const s = Math.floor(data.uptime % 60).toString().padStart(2,'0');
            document.getElementById('uptimeText').innerText = `${h}:${m}:${s}`;
            
            // วงกลมหมุนตามวินาที
            const ring = document.getElementById('uptimeRing');
            const offset = 220 - (220 * (s / 60));
            ring.style.strokeDashoffset = offset;
        });

        socket.on('log-update', (data) => {
            addLog(data.type, data.msg);
        });

        function addLog(type, msg) {
            const container = document.getElementById('logContainer');
            const div = document.createElement('div');
            div.className = 'log-entry ' + (type === 'error' ? 'error' : '');
            const time = new Date().toLocaleTimeString('en-GB', {hour12:false});
            div.innerHTML = `[${time}] <span>${msg}</span>`;
            container.appendChild(div);
            if(container.children.length > 5) container.removeChild(container.firstChild);
        }

        window.addEventListener('resize', () => { resizeCanvas(waveCanvas); resizeCanvas(netCanvas); });
    </script>
</body>
</html>
