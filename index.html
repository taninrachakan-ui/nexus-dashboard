<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS // REAL MONITOR</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="/socket.io/socket.io.js"></script>

    <style>
        /* THEME & LAYOUT */
        :root { --bg-dark: #080a12; --card-bg: rgba(20, 25, 40, 0.6); --primary: #00f0ff; --secondary: #00ff9d; --accent: #7000ff; --text-dim: #8b9bb4; }
        * { box-sizing: border-box; }
        body { margin: 0; background: var(--bg-dark); color: #fff; font-family: 'Rajdhani', sans-serif; padding: 20px; overflow-x: hidden; min-height: 100vh; background-image: radial-gradient(circle at 50% 50%, rgba(0, 240, 255, 0.05), transparent 60%); }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        .status-dot { width: 10px; height: 10px; background: #333; border-radius: 50%; box-shadow: 0 0 5px #333; transition: 0.3s; }
        .status-dot.online { background: var(--secondary); box-shadow: 0 0 10px var(--secondary); }

        .dashboard { display: grid; gap: 20px; }
        .card { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; backdrop-filter: blur(10px); }
        .card-head { font-size: 12px; color: var(--text-dim); letter-spacing: 2px; margin-bottom: 10px; display: block; }
        
        /* BIG NUMBER */
        .big-stat { font-size: 48px; font-weight: 700; color: #fff; text-shadow: 0 0 20px rgba(0, 240, 255, 0.5); }
        .stat-label { font-size: 12px; color: var(--primary); }

        /* LOG BOX */
        .log-box { height: 100px; overflow-y: auto; font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-dim); border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; }
        .log-item { margin-bottom: 4px; border-bottom: 1px dashed rgba(255,255,255,0.05); padding-bottom: 2px; }
        .log-item span { color: var(--primary); }

        /* VISUALIZER CANVAS */
        canvas { width: 100%; height: 80px; }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h2 style="margin:0;">NEXUS CORE</h2>
            <div style="font-size:10px; color:var(--text-dim);">SYSTEM MONITOR V.2</div>
        </div>
        <div style="display:flex; align-items:center; gap:8px;">
            <div style="font-size:10px;">SERVER STATUS</div>
            <div class="status-dot" id="server-status"></div>
        </div>
    </div>

    <div class="dashboard">
        <div class="card">
            <span class="card-head">ACTIVE UNITS</span>
            <div style="display:flex; align-items:center; justify-content:space-between;">
                <div>
                    <div class="big-stat" id="user-count">0</div>
                    <div class="stat-label">OPERATIVES ONLINE</div>
                </div>
                <div style="width: 100px; height: 50px;">
                    <canvas id="miniChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <span class="card-head">UPLINK LOGS</span>
            <div class="log-box" id="log-container">
                <div class="log-item">SYSTEM INITIALIZED... WAITING FOR SIGNALS</div>
            </div>
        </div>

        <div class="card">
            <span class="card-head">SIGNAL FREQUENCY</span>
            <canvas id="waveCanvas"></canvas>
        </div>
    </div>

    <script>
        const socket = io(); // เชื่อมต่อ Server อัตโนมัติ

        // UI Elements
        const elStatus = document.getElementById('server-status');
        const elCount = document.getElementById('user-count');
        const elLogs = document.getElementById('log-container');

        // 1. ตรวจสอบสถานะ Server
        socket.on('connect', () => {
            elStatus.classList.add('online');
            addLog("CONNECTION ESTABLISHED TO CORE");
        });

        socket.on('disconnect', () => {
            elStatus.classList.remove('online');
            addLog("CONNECTION LOST - RECONNECTING...");
        });

        // 2. รับข้อมูล Real-time (จำนวนคน + ใครเข้า)
        socket.on('update-stats', (data) => {
            // อัปเดตตัวเลข
            animateValue(elCount, parseInt(elCount.innerText), data.count, 500);
            
            // อัปเดต Log
            if(data.lastAction) {
                addLog(data.lastAction);
            }
        });

        // ฟังก์ชันเสริม: เพิ่ม Log
        function addLog(msg) {
            const time = new Date().toLocaleTimeString('en-US', {hour12:false});
            const div = document.createElement('div');
            div.className = 'log-item';
            div.innerHTML = `<span>[${time}]</span> ${msg}`;
            elLogs.prepend(div); // ใส่บนสุด
        }

        // ฟังก์ชันเสริม: อนิเมชั่นตัวเลขวิ่ง
        function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // --- GRAPHICS (ตกแต่งให้ดูเท่) ---
        const cvs = document.getElementById('waveCanvas');
        const ctx = cvs.getContext('2d');
        let phase = 0;

        function draw() {
            // Resize Canvas to fit CSS
            cvs.width = cvs.offsetWidth;
            cvs.height = cvs.offsetHeight;
            
            ctx.clearRect(0, 0, cvs.width, cvs.height);
            ctx.beginPath();
            ctx.strokeStyle = '#00f0ff';
            ctx.lineWidth = 2;

            const midY = cvs.height / 2;
            for(let x=0; x<cvs.width; x++) {
                // คลื่น Sine Wave
                const y = midY + Math.sin(x * 0.05 + phase) * 15 * Math.sin(x * 0.01 - phase);
                ctx.lineTo(x, y);
            }
            ctx.stroke();
            phase += 0.1;
            requestAnimationFrame(draw);
        }
        draw();

    </script>
</body>
</html>
